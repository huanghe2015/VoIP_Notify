# 电话提醒系统

## 背景

为了让夜班睡个好觉，在需要的时候立刻做出反应，需要在有相关的邮件的时候做出提醒，通过电话的语音读出邮件主旨的方式通知。

## 需求描述

用户注册登录后购买点数，当需要提醒（如邮件客户端收到需要通知的邮件）时，会通过HTTP API通知本系统，然后本系统先检查拨打的号码是否符合规则，符合将请求加入TTS队列。

加入TTS队列：首先检查字数对应的剩余总时长是否充足，然后检查点数是否充足，成功则将相关信息写入TTS队列，扣除相应点数，返回调用成功，如果点数不足，则会拒绝请求，返回“点数不足”的信息。

TTS队列有一个监控程序，监控到TTS队列中有请求时将信息提取出来，然后将信息做TTS转换，失败则重试并报告，转换出语音后将信息写入通知队列。

通知队列有一个监控程序，监控到通知队列有请求时将语音等信息提取出来，然后拨打信息中的号码，如果拨打失败，则将其放入队尾，等待下次再次拨打，拨打成功则播放语音，播放完毕后自动挂断。

统计所用的通话时长，超过规定总值则停止接收新的请求，新的请求返回“时长已用完”。

## 技术选型

TTS：EdgeTTS

Web框架：Flask

消息队列：
